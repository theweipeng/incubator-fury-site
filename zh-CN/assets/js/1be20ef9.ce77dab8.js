"use strict";(self.webpackChunkfury_site=self.webpackChunkfury_site||[]).push([[7425],{13249:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>o});var i=n(85893),a=n(11151);const s={title:"GraalVM \u6307\u5357",sidebar_position:6,id:"graalvm_guide"},l=void 0,t={id:"guide/graalvm_guide",title:"GraalVM \u6307\u5357",description:"GraalVM Native Image \u4ecb\u7ecd",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/guide/graalvm_guide.md",sourceDirName:"guide",slug:"/guide/graalvm_guide",permalink:"/zh-CN/docs/guide/graalvm_guide",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fury-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/current/guide/graalvm_guide.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"GraalVM \u6307\u5357",sidebar_position:6,id:"graalvm_guide"},sidebar:"guideSidebar",previous:{title:"Scala \u5e8f\u5217\u5316\u6307\u5357",permalink:"/zh-CN/docs/guide/scala_guide"},next:{title:"\u5f00\u53d1\u6307\u5357",permalink:"/zh-CN/docs/guide/development"}},c={},o=[{value:"GraalVM Native Image \u4ecb\u7ecd",id:"graalvm-native-image-\u4ecb\u7ecd",level:2},{value:"\u7ebf\u7a0b\u4e0d\u5b89\u5168",id:"\u7ebf\u7a0b\u4e0d\u5b89\u5168",level:2},{value:"\u7ebf\u7a0b\u5b89\u5168",id:"\u7ebf\u7a0b\u5b89\u5168",level:2},{value:"\u6846\u67b6\u96c6\u6210",id:"\u6846\u67b6\u96c6\u6210",level:2},{value:"\u57fa\u51c6\u6d4b\u8bd5",id:"\u57fa\u51c6\u6d4b\u8bd5",level:2},{value:"\u7ed3\u6784\u4f53\u57fa\u51c6\u6d4b\u8bd5",id:"\u7ed3\u6784\u4f53\u57fa\u51c6\u6d4b\u8bd5",level:3},{value:"\u7c7b\u5b57\u6bb5",id:"\u7c7b\u5b57\u6bb5",level:4},{value:"\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c",id:"\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c",level:4},{value:"Pojo \u57fa\u51c6\u6d4b\u8bd5",id:"pojo-\u57fa\u51c6\u6d4b\u8bd5",level:3},{value:"\u7c7b\u5b57\u6bb5",id:"\u7c7b\u5b57\u6bb5-1",level:4},{value:"\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c",id:"\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c-1",level:4}];function d(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.h2,{id:"graalvm-native-image-\u4ecb\u7ecd",children:"GraalVM Native Image \u4ecb\u7ecd"}),"\n",(0,i.jsx)(r.p,{children:"GraalVM Native Image \u80fd\u591f\u5c06 Java \u5e94\u7528\u4ee3\u7801\u7f16\u8bd1\u6210\u4e3a\u539f\u751f\u7684\u672c\u5730\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\uff0c\u4ee5\u6784\u5efa\u66f4\u5feb\u3001\u66f4\u5c0f\u3001\u66f4\u7cbe\u7b80\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\n\u5176\u4e0d\u80fd\u4f7f\u7528 JIT \u7f16\u8bd1\u5668\u5c06\u5b57\u8282\u7801\u7f16\u8bd1\u4e3a\u673a\u5668\u7801\uff0c\u5e76\u4e14\u5728\u6ca1\u6709\u914d\u7f6e\u76f8\u5173\u53cd\u5c04\u6587\u4ef6\u7684\u524d\u63d0\u4e0b\u4e0d\u652f\u6301\u53cd\u5c04\uff0c\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\u4f7f\u7528\u8f83\u4e3a\u590d\u6742\u3002"}),"\n",(0,i.jsxs)(r.p,{children:["Apache Fury \u5bf9 GraalVM Native Image \u652f\u6301\u975e\u5e38\u5b8c\u5584\u3002Apache Fury \u5728 Graalvm \u6784\u5efa\u65f6\u80fd\u591f\u4e3a ",(0,i.jsx)(r.code,{children:"Fury JIT framework"})," \u548c ",(0,i.jsx)(r.code,{children:"MethodHandle/LambdaMetafactory"})," \u751f\u6210\u6240\u6709\u7684\u5e8f\u5217\u5316\u4ee3\u7801\u3002\u7136\u540e\u5728\u8fd0\u884c\u65f6\u4f7f\u7528\u8fd9\u4e9b\u751f\u6210\u7684\u4ee3\u7801\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u65e0\u9700\u4efb\u4f55\u989d\u5916\u6210\u672c\uff0c\u6027\u80fd\u975e\u5e38\u51fa\u8272\u3002"]}),"\n",(0,i.jsxs)(r.p,{children:["\u4e3a\u4e86\u5728 Graalvm Native Images \u4e0a\u4f7f\u7528 Fury\uff0c\u60a8\u5fc5\u987b\u5c06 Apache Fury \u521b\u5efa\u4e3a",(0,i.jsx)(r.strong,{children:"\u9759\u6001"}),"\u7684\u7c7b\u5b57\u6bb5\uff0c\u5e76\u4e14\u5728 ",(0,i.jsx)(r.code,{children:"enclosing class"})," \u521d\u59cb\u5316\u65f6\u95f4\u671f\u95f4\u5b8c\u6210\u6240\u6709\u7684\u7c7b",(0,i.jsx)(r.strong,{children:"\u6ce8\u518c"}),"\u3002 \u7136\u540e\u5728",(0,i.jsx)(r.code,{children:"resources/META-INF/native-image/$xxx/"})," \u76ee\u5f55\u4e0b\u6dfb\u52a0 ",(0,i.jsx)(r.code,{children:"native-image.properties"})," \u914d\u7f6e\u6587\u4ef6\u3002\u6307\u5bfc GraalVM \u5728\u6784\u5efa Native Images \u65f6\u521d\u59cb\u5316\u914d\u7f6e\u7684\u7c7b\u3002"]}),"\n",(0,i.jsxs)(r.p,{children:["\u4f8b\u5982\uff0c\u8fd9\u91cc\u6211\u4eec\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165 ",(0,i.jsx)(r.code,{children:"org.apache.fury.graalvm.Example"})," \u7c7b\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-properties",children:"Args = --initialize-at-build-time=org.apache.fury.graalvm.Example\n"})}),"\n",(0,i.jsxs)(r.p,{children:["\u4f7f\u7528 Apache Fury \u7684\u53e6\u4e00\u4e2a\u597d\u5904\u662f\uff0c\u60a8\u4e0d\u5fc5\u914d\u7f6e",(0,i.jsx)(r.a,{href:"https://www.graalvm.org/latest/reference-manual/native-image/metadata/#specifying-reflection-metadata-in-json",children:"\u53cd\u5c04 JSON"}),"\u548c",(0,i.jsx)(r.a,{href:"https://www.graalvm.org/latest/reference-manual/native-image/metadata/#serialization",children:"\u5e8f\u5217\u5316 JSON"}),"\uff0c\u8fd9\u975e\u5e38\u4e4f\u5473\u3001\u7e41\u7410\u4e14\u4e0d\u65b9\u4fbf\u3002\u4f7f\u7528 Apache Fury \u65f6\uff0c\u60a8\u53ea\u9700\u4e3a\u8981\u5e8f\u5217\u5316\u7684\u6bcf\u4e2a\u7c7b\u578b\u8c03\u7528 ",(0,i.jsx)(r.code,{children:"org.apache.fury.Fury.register(Class<?>, boolean)"})," \u5373\u53ef\u3002"]}),"\n",(0,i.jsxs)(r.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u7531\u4e8e GraalVM Native Image \u5728\u955c\u50cf\u8fd0\u884c\u65f6\u4e0d\u652f\u6301 JIT\uff0c\u56e0\u6b64 Apache Fury \u7684 ",(0,i.jsx)(r.code,{children:"asyncCompilationEnabled"})," \u9009\u9879\u5c06\u5728\u4f7f\u7528 GraalVM Native Image \u6784\u5efa\u5e94\u7528\u65f6\u81ea\u52a8\u7981\u7528\u3002"]}),"\n",(0,i.jsx)(r.h2,{id:"\u7ebf\u7a0b\u4e0d\u5b89\u5168",children:"\u7ebf\u7a0b\u4e0d\u5b89\u5168"}),"\n",(0,i.jsx)(r.p,{children:"Example\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:'import org.apache.fury.Fury;\nimport org.apache.fury.util.Preconditions;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic class Example {\n  public record Record (\n    int f1,\n    String f2,\n    List<String> f3,\n    Map<String, Long> f4) {\n  }\n\n  static Fury fury;\n\n  static {\n    fury = Fury.builder().build();\n    // register and generate serializer code.\n    fury.register(Record.class, true);\n  }\n\n  public static void main(String[] args) {\n    Record record = new Record(10, "abc", List.of("str1", "str2"), Map.of("k1", 10L, "k2", 20L));\n    System.out.println(record);\n    byte[] bytes = fury.serialize(record);\n    Object o = fury.deserialize(bytes);\n    System.out.println(o);\n    Preconditions.checkArgument(record.equals(o));\n  }\n}\n'})}),"\n",(0,i.jsxs)(r.p,{children:["\u4e4b\u540e\u5728 ",(0,i.jsx)(r.code,{children:"native-image.properties"})," \u4e2d\u52a0\u5165 ",(0,i.jsx)(r.code,{children:"org.apache.fury.graalvm.Example"})," \u914d\u7f6e\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-properties",children:"Args = --initialize-at-build-time=org.apache.fury.graalvm.Example\n"})}),"\n",(0,i.jsx)(r.h2,{id:"\u7ebf\u7a0b\u5b89\u5168",children:"\u7ebf\u7a0b\u5b89\u5168"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:'import org.apache.fury.Fury;\nimport org.apache.fury.ThreadLocalFury;\nimport org.apache.fury.ThreadSafeFury;\nimport org.apache.fury.util.Preconditions;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic class ThreadSafeExample {\n  public record Foo (\n    int f1,\n    String f2,\n    List<String> f3,\n    Map<String, Long> f4) {\n  }\n\n  static ThreadSafeFury fury;\n\n  static {\n    fury = new ThreadLocalFury(classLoader -> {\n      Fury f = Fury.builder().build();\n      // register and generate serializer code.\n      f.register(Foo.class, true);\n      return f;\n    });\n  }\n\n  public static void main(String[] args) {\n    System.out.println(fury.deserialize(fury.serialize("abc")));\n    System.out.println(fury.deserialize(fury.serialize(List.of(1,2,3))));\n    System.out.println(fury.deserialize(fury.serialize(Map.of("k1", 1, "k2", 2))));\n    Foo foo = new Foo(10, "abc", List.of("str1", "str2"), Map.of("k1", 10L, "k2", 20L));\n    System.out.println(foo);\n    byte[] bytes = fury.serialize(foo);\n    Object o = fury.deserialize(bytes);\n    System.out.println(o);\n  }\n}\n'})}),"\n",(0,i.jsxs)(r.p,{children:["\u4e4b\u540e\u5728 ",(0,i.jsx)(r.code,{children:"native-image.properties"})," \u4e2d\u52a0\u5165 ",(0,i.jsx)(r.code,{children:"org.apache.fury.graalvm.ThreadSafeExample"})," \u914d\u7f6e\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-properties",children:"Args = --initialize-at-build-time=org.apache.fury.graalvm.ThreadSafeExample\n"})}),"\n",(0,i.jsx)(r.h2,{id:"\u6846\u67b6\u96c6\u6210",children:"\u6846\u67b6\u96c6\u6210"}),"\n",(0,i.jsxs)(r.p,{children:["\u5bf9\u4e8e\u6846\u67b6\u5f00\u53d1\u4eba\u5458\uff0c\u5982\u679c\u60a8\u60f3\u96c6\u6210 Apache Fury \u8fdb\u884c\u5e8f\u5217\u5316\u3002\u60a8\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u8ba9\u7528\u6237\u5217\u51fa\u4ed6\u4eec\u60f3\u8981\u5e8f\u5217\u5316\u7684\u6240\u6709\u7c7b\uff0c\u7136\u540e\u60a8\u53ef\u4ee5\u52a0\u8f7d\u8fd9\u4e9b\u7c7b\u5e76\u8c03\u7528 ",(0,i.jsx)(r.code,{children:"org.apache.fury.Fury.register(Class<?>, boolean)"})," \u5728\u60a8\u7684 Fury \u96c6\u6210\u7c7b\u4e2d\u6ce8\u518c\u8fd9\u4e9b\u7c7b\uff0c\u5e76\u914d\u7f6e\u8be5\u7c7b\u5728 GraalVM Native Image \u6784\u5efa\u65f6\u8fdb\u884c\u521d\u59cb\u5316\u3002"]}),"\n",(0,i.jsx)(r.h2,{id:"\u57fa\u51c6\u6d4b\u8bd5",children:"\u57fa\u51c6\u6d4b\u8bd5"}),"\n",(0,i.jsx)(r.p,{children:"\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u7ed9\u51fa\u4e86 Apache Fury \u548c Graalvm \u5e8f\u5217\u5316\u4e4b\u95f4\u7684\u4e24\u4e2a\u7c7b\u57fa\u51c6\u6d4b\u8bd5\u3002"}),"\n",(0,i.jsx)(r.p,{children:"\u7981\u7528 Apache Fury compression \u65f6\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Struct\uff1aFury \u4e0e ",(0,i.jsx)(r.code,{children:"46x speed, 43% size"})," JDK \u8fdb\u884c\u6bd4\u8f83\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:["Pojo\uff1aFury \u4e0e ",(0,i.jsx)(r.code,{children:"12x speed, 56% size"})," JDK\u8fdb\u884c\u6bd4\u8f83\u3002"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u542f\u7528 Apache Fury compression \u65f6\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Struct\uff1aFury \u4e0e ",(0,i.jsx)(r.code,{children:"24x speed, 31% size"})," JDK\u8fdb\u884c\u6bd4\u8f83\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:["Pojo\uff1aFury \u4e0e ",(0,i.jsx)(r.code,{children:"12x speed, 48% size"})," JDK\u8fdb\u884c\u6bd4\u8f83\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:["\u6709\u5173\u57fa\u51c6\u6d4b\u8bd5\u4ee3\u7801\uff0c\u8bf7\u53c2\u9605 ",(0,i.jsx)(r.a,{href:"https://github.com/apache/fury/blob/main/integration_tests/graalvm_tests/src/main/java/org/apache/fury/graalvm/Benchmark.java",children:"Benchmark.java"}),"\u3002"]}),"\n",(0,i.jsx)(r.h3,{id:"\u7ed3\u6784\u4f53\u57fa\u51c6\u6d4b\u8bd5",children:"\u7ed3\u6784\u4f53\u57fa\u51c6\u6d4b\u8bd5"}),"\n",(0,i.jsx)(r.h4,{id:"\u7c7b\u5b57\u6bb5",children:"\u7c7b\u5b57\u6bb5"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:"public class Struct implements Serializable {\n  public int f1;\n  public long f2;\n  public float f3;\n  public double f4;\n  public int f5;\n  public long f6;\n  public float f7;\n  public double f8;\n  public int f9;\n  public long f10;\n  public float f11;\n  public double f12;\n}\n"})}),"\n",(0,i.jsx)(r.h4,{id:"\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c",children:"\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c"}),"\n",(0,i.jsx)(r.p,{children:"\u4e0d\u5f00\u542f\u538b\u7f29\u65f6\u6d4b\u8bd5\u7ed3\u679c\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"Benchmark repeat number: 400000\nObject type: class org.apache.fury.graalvm.Struct\nCompress number: false\nFury size: 76.0\nJDK size: 178.0\nFury serialization took mills: 49\nJDK serialization took mills: 2254\nCompare speed: Fury is 45.70x speed of JDK\nCompare size: Fury is 0.43x size of JDK\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u5f00\u542f\u538b\u7f29\u65f6\u6d4b\u8bd5\u7ed3\u679c\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"Benchmark repeat number: 400000\nObject type: class org.apache.fury.graalvm.Struct\nCompress number: true\nFury size: 55.0\nJDK size: 178.0\nFury serialization took mills: 130\nJDK serialization took mills: 3161\nCompare speed: Fury is 24.16x speed of JDK\nCompare size: Fury is 0.31x size of JDK\n"})}),"\n",(0,i.jsx)(r.h3,{id:"pojo-\u57fa\u51c6\u6d4b\u8bd5",children:"Pojo \u57fa\u51c6\u6d4b\u8bd5"}),"\n",(0,i.jsx)(r.h4,{id:"\u7c7b\u5b57\u6bb5-1",children:"\u7c7b\u5b57\u6bb5"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:"public class Foo implements Serializable {\n  int f1;\n  String f2;\n  List<String> f3;\n  Map<String, Long> f4;\n}\n"})}),"\n",(0,i.jsx)(r.h4,{id:"\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c-1",children:"\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c"}),"\n",(0,i.jsx)(r.p,{children:"\u4e0d\u5f00\u542f\u538b\u7f29\u65f6\u6d4b\u8bd5\u7ed3\u679c\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"Benchmark repeat number: 400000\nObject type: class org.apache.fury.graalvm.Foo\nCompress number: false\nFury size: 541.0\nJDK size: 964.0\nFury serialization took mills: 1663\nJDK serialization took mills: 16266\nCompare speed: Fury is 12.19x speed of JDK\nCompare size: Fury is 0.56x size of JDK\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u5f00\u542f\u538b\u7f29\u65f6\u6d4b\u8bd5\u7ed3\u679c\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"Benchmark repeat number: 400000\nObject type: class org.apache.fury.graalvm.Foo\nCompress number: true\nFury size: 459.0\nJDK size: 964.0\nFury serialization took mills: 1289\nJDK serialization took mills: 15069\nCompare speed: Fury is 12.11x speed of JDK\nCompare size: Fury is 0.48x size of JDK\n"})})]})}function u(e={}){const{wrapper:r}={...(0,a.a)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},11151:(e,r,n)=>{n.d(r,{Z:()=>t,a:()=>l});var i=n(67294);const a={},s=i.createContext(a);function l(e){const r=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(s.Provider,{value:r},e.children)}}}]);